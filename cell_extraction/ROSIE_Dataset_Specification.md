# ROSIEè®­ç»ƒæ•°æ®é›†å®Œæ•´è§„èŒƒæ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

ROSIE (H&E/å¤šæŸ“è‰²åˆ°å¤šmarkerå›å½’) è®­ç»ƒæ•°æ®é›†åŒ…å«ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ã€‚æœ¬ç‰ˆæœ¬é¢å‘ä½ çš„TMAæ•°æ®ï¼šå…«ç§è¯•å‰‚åˆ†åˆ«ä¸º CD3ã€CD8ã€CD56ã€CD68ã€CD163ã€HEã€MHC1ã€PDL1ï¼Œæ¯ç§éƒ½æ˜¯ä¸‰é€šé“RGBæ™®é€šç…§ç‰‡ã€‚è®­ç»ƒ/æ¨ç†çš„ç›®æ ‡æ˜¯å¯¹è¿™8ä¸ªmarkerè¿›è¡Œå›å½’ï¼ˆæ¯ä¸ªmarkerè¾“å‡º3ä¸ªå€¼ï¼Œå¯¹åº”RGBé€šé“ï¼‰ï¼Œåˆè®¡24ç»´è¾“å‡ºã€‚

## ğŸ—‚ï¸ æ•°æ®é›†ç›®å½•ç»“æ„

```
ROSIE_DATASET/
â”œâ”€â”€ data/                               # æ ¸å¿ƒæ•°æ®æ–‡ä»¶å¤¹
â”‚   â””â”€â”€ cell_measurements.pqt          # ä¸»æ•°æ®è¡¨ï¼ˆåŒ…å«å…¨éƒ¨æ˜ å°„/è·¯å¾„/åæ ‡/æ ‡ç­¾ï¼‰
â”œâ”€â”€ images/                             # å…«ç§è¯•å‰‚çš„RGBå›¾ç‰‡ï¼ˆPNG/JPEGï¼‰
â”‚   â”œâ”€â”€ tma_tumorcenter_CD3/
â”‚   â”œâ”€â”€ tma_tumorcenter_CD8/
â”‚   â”œâ”€â”€ tma_tumorcenter_CD56/
â”‚   â”œâ”€â”€ tma_tumorcenter_CD68/
â”‚   â”œâ”€â”€ tma_tumorcenter_CD163/
â”‚   â”œâ”€â”€ tma_tumorcenter_HE/
â”‚   â”œâ”€â”€ tma_tumorcenter_MHC1/
â”‚   â””â”€â”€ tma_tumorcenter_PDL1/
â”œâ”€â”€ metadata/
â”‚   â””â”€â”€ dataset_splits.json             # æ•°æ®é›†åˆ’åˆ†ï¼ˆå¯é€‰ï¼‰
â””â”€â”€ runs/                              # è®­ç»ƒè¾“å‡ºï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
```

---

## ğŸ“Š 1. æ ¸å¿ƒæ•°æ®æ–‡ä»¶ (`data/cell_measurements.pqt`)

### æ–‡ä»¶æ ¼å¼
- **æ ¼å¼**: Apache Parquet (.pqt)
- **å‹ç¼©**: æ¨èsnappyæˆ–gzip
- **è§„æ¨¡**: ä¾æ®æ ·æœ¬é‡è€Œå®š

### æ•°æ®ç»“æ„

#### å¿…éœ€å­—æ®µï¼ˆå®šä½/é€‰æ‹©ï¼‰
| å­—æ®µå | æ•°æ®ç±»å‹ | æè¿° | ç¤ºä¾‹ |
|--------|----------|------|------|
| `HE_COVERSLIP_ID` | string | åˆ‡ç‰‡/èŠ¯ç‰‡IDï¼Œç”¨äºç­›é€‰/åˆ’åˆ† | "HE_block9" |
| `X` | int64 | ç»†èƒä¸­å¿ƒXåæ ‡ï¼ˆåƒç´ ï¼‰ | 1500 |
| `Y` | int64 | ç»†èƒä¸­å¿ƒYåæ ‡ï¼ˆåƒç´ ï¼‰ | 2000 |
| `core_block` | string/int | TMA blockç¼–å·ï¼ˆå¯é€‰ï¼‰ | 9 |
| `core_x`, `core_y` | int | TMAç½‘æ ¼åæ ‡ï¼ˆå¯é€‰ï¼‰ | 6, 9 |
| `patient_id` | string | ç—…äººIDï¼ˆå¯é€‰ï¼‰ | "patient510" |

#### è·¯å¾„/æ–‡ä»¶å­—æ®µï¼ˆå…«ç§è¯•å‰‚çš„RGBå›¾ï¼‰
| å­—æ®µå | æ•°æ®ç±»å‹ | æè¿° | ç¤ºä¾‹ |
|--------|----------|------|------|
| `path_CD3` | string | CD3å›¾ç‰‡æ–‡ä»¶ç›¸å¯¹/ç»å¯¹è·¯å¾„ | images/tma_tumorcenter_CD3/TumorCenter_CD3_block9_x6_y9_patient510.png |
| `path_CD8` | string | CD8å›¾ç‰‡è·¯å¾„ | images/tma_tumorcenter_CD8/... |
| `path_CD56` | string | CD56å›¾ç‰‡è·¯å¾„ | ... |
| `path_CD68` | string | CD68å›¾ç‰‡è·¯å¾„ | ... |
| `path_CD163` | string | CD163å›¾ç‰‡è·¯å¾„ | ... |
| `path_HE` | string | HEå›¾ç‰‡è·¯å¾„ | images/tma_tumorcenter_HE/... |
| `path_MHC1` | string | MHC1å›¾ç‰‡è·¯å¾„ | ... |
| `path_PDL1` | string | PDL1å›¾ç‰‡è·¯å¾„ | ... |

è¯´æ˜ï¼šè‹¥æŸè¯•å‰‚å›¾ç‰‡ç¼ºå¤±ï¼Œè·¯å¾„å­—æ®µç½®ä¸ºNAã€‚

#### å›å½’ç›®æ ‡ï¼ˆæ ‡ç­¾ï¼‰
æ¯ä¸ªmarkerä¸ºä¸‰é€šé“RGBï¼Œå»ºè®®åœ¨æ•°æ®è¡¨ä¸­å­˜å‚¨ä¸ºä¸‹åˆ—24åˆ—ä¸­çš„ä»»æ„ä¸€ç§è¡¨ç¤ºï¼ˆé€‰ä¸€ç§å³å¯ï¼Œå¦ä¸€ç§å¯è¿è¡Œæ—¶è½¬æ¢ï¼‰ï¼š

- å±•å¼€åˆ—ï¼ˆæ¨èä¾¿äºç›´æ¥è®­ç»ƒï¼‰
  - `CD3_R`, `CD3_G`, `CD3_B`
  - `CD8_R`, `CD8_G`, `CD8_B`
  - `CD56_R`, `CD56_G`, `CD56_B`
  - `CD68_R`, `CD68_G`, `CD68_B`
  - `CD163_R`, `CD163_G`, `CD163_B`
  - `HE_R`, `HE_G`, `HE_B`
  - `MHC1_R`, `MHC1_G`, `MHC1_B`
  - `PDL1_R`, `PDL1_G`, `PDL1_B`

- æˆ–JSONåˆ—ï¼ˆæ›´ç´§å‡‘ä½†éœ€è§£æï¼‰
  - `targets_json`ï¼ˆç¤ºä¾‹ï¼š{"CD3":[r,g,b], ...}ï¼‰ï¼Œç¼ºå¤±markerå†™å…¥nullæˆ–çœç•¥è¯¥é”®

ç¼ºå¤±å€¼ä¸€å¾‹ç”¨NAï¼ˆæˆ–JSONä¸­çš„nullï¼‰æ ‡è®°ï¼Œè®­ç»ƒæ—¶ç”¨maskå¿½ç•¥ã€‚


### ç¤ºä¾‹æ•°æ®è¡Œ
```python
{
    "CODEX_ACQUISITION_ID": "Stanford_PGC_001",
    "HE_COVERSLIP_ID": "HE_slide_001", 
    "X": 15420,
    "Y": 23680,
    "DAPI": 2.34,
    "CD45": 0.12,
    "CD68": 0.0,
    "PanCK": 4.56,
    "Ki67": 0.03,
    # ... å…¶ä»–45ä¸ªæ ‡è®°ç‰©
}
```

---

## ğŸ–¼ï¸ 2. å›¾åƒæ–‡ä»¶å¤¹ï¼ˆå…«ç§è¯•å‰‚ï¼ŒRGBï¼‰

### ç›®å½•ç»“æ„
```
images/
â”œâ”€â”€ tma_tumorcenter_CD3/
â”œâ”€â”€ tma_tumorcenter_CD8/
â”œâ”€â”€ tma_tumorcenter_CD56/
â”œâ”€â”€ tma_tumorcenter_CD68/
â”œâ”€â”€ tma_tumorcenter_CD163/
â”œâ”€â”€ tma_tumorcenter_HE/
â”œâ”€â”€ tma_tumorcenter_MHC1/
â””â”€â”€ tma_tumorcenter_PDL1/
```

### æ–‡ä»¶æ ¼å¼è§„èŒƒ

#### å›¾åƒæ ¼å¼è¦æ±‚
- **æ ¼å¼**: PNG/JPEGï¼ˆRGBä¸‰é€šé“ï¼‰
- **æ•°æ®ç±»å‹**: uint8 (0-255)
- **å‘½å**: å¯æ²¿ç”¨ç°æœ‰å‘½åï¼ˆå¦‚ TumorCenter_CD3_block9_x6_y9_patient510.pngï¼‰
- **å°ºå¯¸**: åŸå›¾å°ºå¯¸ä¿ç•™ï¼›è®­ç»ƒæ—¶ç”±DataLoaderæŒ‰éœ€è£å‰ª/ç¼©æ”¾

#### å›¾åƒè´¨é‡æ ‡å‡†
- **åˆ†è¾¨ç‡**: â‰¥20000Ã—20000åƒç´  (40xæ‰«æ)
- **åƒç´ å°ºå¯¸**: 0.25Î¼m/pixel (æ¨è)
- **æŸ“è‰²è´¨é‡**: å‡åŒ€H&EæŸ“è‰²ï¼Œæ— æ¨¡ç³Š
- **æ–‡ä»¶å¤§å°**: å•ä¸ªZarræ–‡ä»¶100MB-2GB

#### å‘½åè§„èŒƒ
- **ç›®å½•å**: HE_REGION_UUID (36å­—ç¬¦UUID)
- **æ–‡ä»¶å**: å›ºå®šä¸º `image.ome.zarr`
- **é€šé“ç›®å½•**: `0/`, `1/`, `2/` (R, G, B)

å¤‡æ³¨ï¼šè‹¥åç»­éœ€è¦é«˜æ•ˆéšæœºè®¿é—®ï¼Œå¯é€‰å°†PNGæ‰¹é‡è½¬ä¸ºZarrï¼Œä½†æœ¬è§„èŒƒä¸å¼ºåˆ¶ã€‚

### dataset_splits.json ç»“æ„

#### æ–‡ä»¶æ ¼å¼
```json
{
  "train": [
    ...
  ],
  "val": [
    ...
  ],
  "test": [
    ...
  ]
}
```

#### åˆ’åˆ†å»ºè®®
- è®­ç»ƒé›†: 80%
- éªŒè¯é›†: 10%  
- æµ‹è¯•é›†: 10%